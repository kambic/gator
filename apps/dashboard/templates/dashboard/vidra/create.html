{% extends 'layout.html' %}

{% block content %}
  <div class="row">
    <div x-data="NewTaskManager()" class="container my-3">
      <fieldset>
        <legend>Media details</legend>

        <!-- Controls -->
        <div class="d-flex justify-content-between mb-3">
          <div>
            <button @click="toggleExpand()" class="btn btn-primary me-2" :disabled="!initComplete">Toggle Expand
            </button>
            <button @click="deselectAll()" class="btn btn-secondary me-2" :disabled="!initComplete">Deselect all
            </button>
            <button @click="enqueue()" class="btn btn-success" :disabled="payloads.length === 0 || !initComplete">
              Enqueue for Vidra
            </button>
          </div>
          <div class="text-muted">
            Selected: <span x-text="payloads.length"></span> items
            <span x-show="!initComplete" class="text-warning ms-2">Initializing...</span>
          </div>
        </div>

        <!-- Settings -->
        <div class="row mb-3">
          <div class="col-2">
            <label for="id_content_type" class="form-label">Content type</label>
            <select id="id_content_type" class="form-select" x-model="contentType">
              <option value="dkino">DKINO</option>
              <option value="dmd">DajMeDol</option>
              <option value="misc">OSTALO</option>
            </select>
          </div>
          <div class="col-6">
            <div class="form-check form-switch me-3">
              <input class="form-check-input" type="checkbox" id="id_drm" x-model="drm"/>
              <label class="form-check-label" for="id_drm">DRM</label>
            </div>
            <div class="form-check form-switch me-3">
              <input class="form-check-input" type="checkbox" id="id_streaming" x-model="streaming"/>
              <label class="form-check-label" for="id_streaming">Streaming</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="id_debug" x-model="debug"/>
              <label class="form-check-label" for="id_debug">DEBUG</label>
            </div>
          </div>
        </div>

        <!-- Tree Container - Ensure it exists -->
        <div class="mb-3">
          <label class="form-label">Media Picker</label>
          <div
              id="picker"
              class="border p-3 rounded wb-alternate wb-fade-expander wb-rainbow"
              style="min-height: 400px; max-height: 600px; overflow: auto; background: white;"
              x-show="true"
          >
          </div>
        </div>

        <!-- Payload Viewer -->
        <div class="accordion my-2">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#payloadCollapse"
                  aria-expanded="false"
              >
                View Payload (<span x-text="payloads.length"></span> items)
              </button>
            </h2>
            <div id="payloadCollapse" class="accordion-collapse collapse">
              <div class="accordion-body">
                <div x-show="payloads.length > 0" class="mb-3">
                  <h6>Payload Preview:</h6>
                  <div class="border rounded p-3 bg-light" style="max-height: 400px; overflow: auto;">
                    <pre x-text="JSON.stringify(payloads, null, 2)" class="small mb-0"></pre>
                  </div>
                </div>
                <div x-show="payloads.length === 0" class="text-muted">
                  No items selected yet.
                </div>
                <div class="mt-2 small text-muted">
                  Content Type: <span x-text="contentType"></span> |
                  DRM: <span x-text="drm"></span> |
                  Streaming: <span x-text="streaming"></span> |
                  Debug: <span x-text="debug"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </fieldset>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
