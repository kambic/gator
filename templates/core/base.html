{% load django_vite %}
{% load static %}

<!DOCTYPE html>
<html lang="en" class="h-full" x-data="appData()" :data-theme="dark ? 'dark' : 'corporate'">

<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}AdminPanel{% endblock %}</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'vendor/fontawesome-free/css/all.min.css' %}">

  {% vite_hmr_client %}
  {% vite_asset 'static/core/js/main.js' %}

  {% block extra_head %}{% endblock %}
</head>

<body class="flex min-h-screen bg-base-200 text-base-content">

<!-- ====================== SIDEBAR ====================== -->
<aside class="bg-base-100 sticky top-0 z-50 flex h-screen flex-col shadow-xl transition-all duration-300"
       :class="sidebarOpen ? 'w-60 px-3 py-4' : 'w-16 px-2 py-4'">

  <!-- Logo + Toggle -->
  <div class="mb-4 flex items-center justify-between">
    <a :href="urls.home" class="flex items-center gap-2 overflow-hidden">
        <span class="text-primary text-xl font-bold transition-all duration-200"
              :class="sidebarOpen ? '' : 'w-0 opacity-0'">
          AdminPanel
        </span>
      <span class="text-primary text-xl font-bold" x-show="!sidebarOpen">A</span>
    </a>
    <button @click="sidebarOpen = !sidebarOpen"
            class="btn btn-ghost btn-xs rounded-full hover:bg-base-200">
      <i :class="sidebarOpen ? 'fa-solid fa-angles-left' : 'fa-solid fa-angles-right'"></i>
    </button>
  </div>

  <!-- Main Menu -->
  <nav class="flex-1">
    <ul class="space-y-0.5 text-sm">
      <template x-for="item in menu" :key="item.url">
        <li>
          <a :href="item.url"
                  {#               :class="activeRoute === item.route ? 'bg-base-200 text-primary font-semibold' : 'hover:bg-base-200'"#}
             class="flex items-center gap-3 rounded-md px-2.5 py-2 transition-colors hover:bg-base-200">
            <i :class="item.icon + ' w-5 text-center'"></i>
            <span x-show="sidebarOpen"
                  class="font-medium"
                  x-transition.opacity.duration.200ms
                  x-text="item.label"></span>
          </a>
        </li>
      </template>
    </ul>
  </nav>

  <!-- Bottom: Settings + Theme -->
  <div class="border-t border-base-300 pt-3 space-y-2">
    <a :href="urls.settings"
       :class="activeRoute === 'core:settings' ? 'bg-base-200 text-primary font-semibold' : 'hover:bg-base-200'"
       class="flex items-center gap-3 rounded-md px-2.5 py-2 transition-colors">
      <i class="fa-solid fa-gear w-5 text-center"></i>
      <span x-show="sidebarOpen" class="font-medium" x-transition.opacity.duration.200ms>Settings</span>
    </a>

    <div class="flex items-center justify-between rounded-md bg-base-200 px-3 py-2">
      <label class="flex cursor-pointer items-center gap-2.5">
        <i class="fa-solid" :class="dark ? 'fa-moon' : 'fa-sun'"></i>
        <span x-show="sidebarOpen" class="text-sm font-medium" x-transition.opacity.duration.200ms>Theme</span>
      </label>
      <input type="checkbox" class="toggle toggle-primary toggle-xs" x-model="dark"/>
    </div>
  </div>
</aside>

<!-- ====================== MAIN CONTENT ====================== -->
<div class="flex-1 flex flex-col min-w-0">
  <header class="navbar bg-base-100 shadow-md rounded-box mx-4 mt-4 mb-3 sticky top-4 z-40">
    <div class="flex-1">
      <h1 class="text-xl font-semibold">{% block page_title %}Dashboard{% endblock %}</h1>
    </div>
    <div class="flex items-center gap-3">
      <button class="btn btn-ghost btn-circle" @click="dark = !dark">
        <i class="fa-solid text-lg" :class="dark ? 'fa-sun' : 'fa-moon'"></i>
      </button>
      <a href="{% url 'logout' %}" class="btn btn-ghost">Logout</a>
    </div>
  </header>

  <main class="flex-1 px-4 pb-6">
    {% block content %}
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <h2 class="card-title">Welcome to AdminPanel!</h2>
          <p>Select a section from the sidebar.</p>
        </div>
      </div>
    {% endblock %}
  </main>
</div>

<!-- ====================== ALPINE GLOBAL DATA (with Django URLs) ====================== -->
<script>
    function appData() {
        const urls = {
            home: "{% url 'core:index' %}",
            shaka: "{% url 'core:shaka' %}",
            fileExplorer: "{% url 'core:file_explorer' %}",
            providers: "{% url 'core:vod-providers-list' %}",
            components: "{% url 'core:components' %}",
            settings: "#"  // adjust if your settings URL name is different
        };

        // Detect current active route by matching pathname
        function getActiveRoute() {
            const path = window.location.pathname;
            const map = {
                [urls.home]: 'core:index',
                [urls.shaka]: 'core:shaka',
                [urls.fileExplorer]: 'core:file_explorer',
                [urls.providers]: 'core:vod-providers-list',
                [urls.components]: 'core:components',
                [urls.settings]: 'core:settings'
            };
            for (const [url, route] of Object.entries(map)) {
                if (path.startsWith(new URL(url, location.origin).pathname.replace(/\/$/, '') || '')) {
                    return route;
                }
            }
            return '';
        }

        return {
            sidebarOpen: true,
            dark: localStorage.getItem('dark') === 'true',
            activeRoute: getActiveRoute(),
            urls: urls,

            menu: [
                {label: 'Dashboard', icon: 'fa-solid fa-gauge-high', url: "{% url 'core:index' %}"},
                {label: 'Edgewares', icon: 'fa-solid fa-server', url: "{% url 'core:edgeware-list' %}"},
                {label: 'Shaka', icon: 'fa-solid fa-video', url: "{% url 'core:shaka' %}"},
                {label: 'File Explorer', icon: 'fa-solid fa-folder-open', url: "{% url 'core:file_explorer' %}"},
                {label: 'Providers', icon: 'fa-solid fa-users-gear', url: "{% url 'core:vod-providers-list' %}"},
                {label: 'Components', icon: 'fa-solid fa-puzzle-piece', url: "{% url 'core:components' %}"},
            ],


            // Persist theme
            init() {
                this.$watch('dark', val => {
                    localStorage.setItem('dark', val);
                    console.log(`[THEME] is dark ${val}`)
                });
            }
        };
    }
</script>
</body>

</html>
