[Unit]
Description=Celery beat scheduler for CMS
After=network.target redis-server.service

[Service]
Type=simple
User={{ deploy_user }}
Group={{ deploy_group }}
WorkingDirectory={{ app_path }}
Environment="PATH={{ app_path }}/venv/bin"
Environment="DJANGO_SETTINGS_MODULE={{ django_settings_module }}"
Environment="CELERY_BROKER_URL={{ celery_broker_url }}"

ExecStart={{ app_path }}/venv/bin/celery \
  -A cms.celery.app beat \
  --loglevel={{ celery_log_level }} \
  --schedule={{ celery_beat_schedule_file }} \
  --pidfile={{ app_path }}/celerybeat.pid

ExecReload=/bin/kill -s HUP $MAINPID
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
